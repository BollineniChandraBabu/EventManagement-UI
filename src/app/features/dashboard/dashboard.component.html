<div class="chart-filter">
  <label for="chartStartDate" class="chart-filter-label">Select date for charts</label>
  <input
    id="chartStartDate"
    type="date"
    class="form-control chart-filter-input"
    [value]="selectedDate"
    [max]="maxDate"
    (change)="onChartDateChange($any($event.target).value)"
  />
</div>

<div class="page" *ngIf="maildata$ | async as data">
  <h2 class="page-title">Mail Dashboard</h2>
  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-label">Total users</div>
      <div class="kpi-value">{{ data.totalUsers }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Upcoming events</div>
      <div class="kpi-value">{{ data.upcomingEvents }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Emails sent today</div>
      <div class="kpi-value">{{ data.emailsSentToday }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Failed emails</div>
      <div class="kpi-value">{{ data.failedEmails }}</div>
    </div>
  </div>

  <div class="mail-flow-grid" *ngIf="auth.isAdmin()">
    <div class="chart-card" *ngIf="otpMailStats$ | async as otpStats">
      <h3 class="chart-title">OTP Mail Dashboard</h3>
      <div class="kpi-grid compact">
        <div class="kpi-card" *ngFor="let metric of mailFlowCards(otpStats)">
          <div class="kpi-label">{{ metric.label }}</div>
          <div class="kpi-value">{{ metric.value }}</div>
        </div>
      </div>

      <ngx-charts-line-chart
        *ngIf="otpMailChart$ | async as otpChartData"
        class="chart-host"
        [results]="otpChartData"
        [scheme]="chartColorScheme"
        [legend]="true"
        [legendPosition]="'below'"
        [xAxis]="true"
        [yAxis]="true"
        [showXAxisLabel]="false"
        [showYAxisLabel]="true"
        [yAxisLabel]="'Emails'"
        [autoScale]="false"
        [yScaleMin]="0"
        [yScaleMax]="chartYAxisMax(otpChartData)"
        [yAxisTickFormatting]="yAxisTickFormatter"
        [roundDomains]="true"
      ></ngx-charts-line-chart>
    </div>

    <div class="chart-card" *ngIf="forgotPasswordMailStats$ | async as forgotPasswordStats">
      <h3 class="chart-title">Forgot Password Mail Dashboard</h3>
      <div class="kpi-grid compact">
        <div class="kpi-card" *ngFor="let metric of mailFlowCards(forgotPasswordStats)">
          <div class="kpi-label">{{ metric.label }}</div>
          <div class="kpi-value">{{ metric.value }}</div>
        </div>
      </div>

      <ngx-charts-line-chart
        *ngIf="forgotPasswordMailChart$ | async as forgotPasswordChartData"
        class="chart-host"
        [results]="forgotPasswordChartData"
        [scheme]="chartColorScheme"
        [legend]="true"
        [legendPosition]="'below'"
        [xAxis]="true"
        [yAxis]="true"
        [showXAxisLabel]="false"
        [showYAxisLabel]="true"
        [yAxisLabel]="'Emails'"
        [autoScale]="false"
        [yScaleMin]="0"
        [yScaleMax]="chartYAxisMax(forgotPasswordChartData)"
        [yAxisTickFormatting]="yAxisTickFormatter"
        [roundDomains]="true"
      ></ngx-charts-line-chart>
    </div>
  </div>

  <div class="chart-card">
    <h3 class="chart-title">Mail Delivery Trend</h3>
    <ngx-charts-line-chart
      *ngIf="mailChart$ | async as mailChartData"
      class="chart-host"
      [results]="mailChartData"
      [scheme]="chartColorScheme"
      [legend]="true"
      [legendPosition]="'below'"
      [xAxis]="true"
      [yAxis]="true"
      [showXAxisLabel]="false"
      [showYAxisLabel]="true"
      [yAxisLabel]="'Emails'"
      [autoScale]="false"
      [yScaleMin]="0"
      [yScaleMax]="chartYAxisMax(mailChartData)"
      [yAxisTickFormatting]="yAxisTickFormatter"
      [roundDomains]="true"
    ></ngx-charts-line-chart>
  </div>
</div>

<div class="page" *ngIf="igdata$ | async as data">
  <h2 class="page-title">Insta Dashboard</h2>
  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-label">Total users</div>
      <div class="kpi-value">{{ data.totalUsers }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Upcoming events</div>
      <div class="kpi-value">{{ data.upcomingEvents }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Emails sent today</div>
      <div class="kpi-value">{{ data.emailsSentToday }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Failed emails</div>
      <div class="kpi-value">{{ data.failedEmails }}</div>
    </div>
  </div>

  <div class="chart-card">
    <h3 class="chart-title">Insta Delivery Trend</h3>
    <ngx-charts-line-chart
      *ngIf="instaChart$ | async as instaChartData"
      class="chart-host"
      [results]="instaChartData"
      [scheme]="chartColorScheme"
      [legend]="true"
      [legendPosition]="'below'"
      [xAxis]="true"
      [yAxis]="true"
      [showXAxisLabel]="false"
      [showYAxisLabel]="true"
      [yAxisLabel]="'Emails'"
      [autoScale]="false"
      [yScaleMin]="0"
      [yScaleMax]="chartYAxisMax(instaChartData)"
      [yAxisTickFormatting]="yAxisTickFormatter"
      [roundDomains]="true"
    ></ngx-charts-line-chart>
  </div>
</div>
