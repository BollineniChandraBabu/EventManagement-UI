<div class="page" *ngIf="maildata$ | async as data">
  <h2 class="page-title">Mail Dashboard</h2>
  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-label">Total users</div>
      <div class="kpi-value">{{ data.totalUsers }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Upcoming events</div>
      <div class="kpi-value">{{ data.upcomingEvents }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Emails sent today</div>
      <div class="kpi-value">{{ data.emailsSentToday }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Failed emails</div>
      <div class="kpi-value">{{ data.failedEmails }}</div>
    </div>
  </div>


  <div class="mail-flow-grid" *ngIf="auth.isAdmin()">
    <div class="chart-card" *ngIf="otpMailStats$ | async as otpStats">
      <h3 class="chart-title">OTP Mail Dashboard</h3>
      <div class="kpi-grid compact">
        <div class="kpi-card" *ngFor="let metric of mailFlowCards(otpStats)">
          <div class="kpi-label">{{ metric.label }}</div>
          <div class="kpi-value">{{ metric.value }}</div>
        </div>
      </div>

      <div class="chart-legend">
        <span><i class="legend-dot sent"></i>Sent</span>
        <span><i class="legend-dot failed"></i>Failed</span>
      </div>

      <div class="bar-chart compact-chart" *ngIf="otpMailChart$ | async as otpChart">
        <div class="bar-group" *ngFor="let point of otpChart">
          <div class="bars">
            <div class="bar sent" [style.height.%]="point.sentHeightPct"></div>
            <div class="bar failed" [style.height.%]="point.failedHeightPct"></div>
          </div>
          <div class="bar-total">{{ point.total }}</div>
          <div class="bar-label">{{ point.dateLabel | date : 'MMM d' }}</div>
        </div>
      </div>
    </div>

    <div class="chart-card" *ngIf="forgotPasswordMailStats$ | async as forgotPasswordStats">
      <h3 class="chart-title">Forgot Password Mail Dashboard</h3>
      <div class="kpi-grid compact">
        <div class="kpi-card" *ngFor="let metric of mailFlowCards(forgotPasswordStats)">
          <div class="kpi-label">{{ metric.label }}</div>
          <div class="kpi-value">{{ metric.value }}</div>
        </div>
      </div>

      <div class="chart-legend">
        <span><i class="legend-dot sent"></i>Sent</span>
        <span><i class="legend-dot failed"></i>Failed</span>
      </div>

      <div class="bar-chart compact-chart" *ngIf="forgotPasswordMailChart$ | async as forgotPasswordChart">
        <div class="bar-group" *ngFor="let point of forgotPasswordChart">
          <div class="bars">
            <div class="bar sent" [style.height.%]="point.sentHeightPct"></div>
            <div class="bar failed" [style.height.%]="point.failedHeightPct"></div>
          </div>
          <div class="bar-total">{{ point.total }}</div>
          <div class="bar-label">{{ point.dateLabel | date : 'MMM d' }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="chart-card" *ngIf="mailChart$ | async as chart">
    <h3 class="chart-title">Mail Delivery Trend</h3>
    <div class="chart-legend">
      <span><i class="legend-dot sent"></i>Sent</span>
      <span><i class="legend-dot failed"></i>Failed</span>
    </div>

    <div class="bar-chart" *ngIf="chart.length; else noMailChartData">
      <div class="bar-group" *ngFor="let point of chart">
        <div class="bars">
          <div class="bar sent" [style.height.%]="point.sentHeightPct" [attr.aria-label]="'Sent ' + point.sent"></div>
          <div class="bar failed" [style.height.%]="point.failedHeightPct" [attr.aria-label]="'Failed ' + point.failed"></div>
        </div>
        <div class="bar-total">{{ point.total }}</div>
        <div class="bar-label">{{ point.dateLabel | date : 'MMM d' }}</div>
      </div>
    </div>

    <ng-template #noMailChartData>
      <div class="empty-chart">No mail chart data available.</div>
    </ng-template>
  </div>
</div>

<div class="page" *ngIf="igdata$ | async as data">
  <h2 class="page-title">Insta Dashboard</h2>
  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-label">Total users</div>
      <div class="kpi-value">{{ data.totalUsers }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Upcoming events</div>
      <div class="kpi-value">{{ data.upcomingEvents }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Emails sent today</div>
      <div class="kpi-value">{{ data.emailsSentToday }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Failed emails</div>
      <div class="kpi-value">{{ data.failedEmails }}</div>
    </div>
  </div>

  <div class="chart-card" *ngIf="instaChart$ | async as chart">
    <h3 class="chart-title">Insta Delivery Trend</h3>
    <div class="chart-legend">
      <span><i class="legend-dot sent"></i>Sent</span>
      <span><i class="legend-dot failed"></i>Failed</span>
    </div>

    <div class="bar-chart" *ngIf="chart.length; else noInstaChartData">
      <div class="bar-group" *ngFor="let point of chart">
        <div class="bars">
          <div class="bar sent" [style.height.%]="point.sentHeightPct" [attr.aria-label]="'Sent ' + point.sent"></div>
          <div class="bar failed" [style.height.%]="point.failedHeightPct" [attr.aria-label]="'Failed ' + point.failed"></div>
        </div>
        <div class="bar-total">{{ point.total }}</div>
        <div class="bar-label">{{ point.dateLabel | date : 'MMM d' }}</div>
      </div>
    </div>

    <ng-template #noInstaChartData>
      <div class="empty-chart">No insta chart data available.</div>
    </ng-template>
  </div>
</div>
